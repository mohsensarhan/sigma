{
  "timestamp": "2025-10-05T13:51:16.278Z",
  "tests": {
    "admin": {
      "hasSlider": true,
      "sliderValue": "5",
      "activeJourneys": "0",
      "completedJourneys": "0",
      "hasErrorLogSection": true
    },
    "donorPage": {
      "loaded": true,
      "donorCount": 0,
      "hasDonateButtons": true
    },
    "map": {
      "hasMap": true,
      "hudText": "1 Active0 CompletedTotal: 1",
      "activeCount": 1,
      "completedCount": 0,
      "markerCount": 5
    },
    "progression": {
      "activeCount": 1,
      "completedCount": 0,
      "hudText": "1 Active0 CompletedTotal: 1"
    },
    "sms": {
      "messageCount": 20,
      "hasMessages": true,
      "bodyText": "\n    SMS InboxMock SMS messages sent to donors👨Ahmed Hassan+2012345678904 messages👩Fatima Ali+2012355678900 messages🧔Mohamed Ibrahim+2012365678900 messages👩‍🦱Sara Mahmoud+2012375678900 messagesMessages for Ahmed Hassanqueued10/5/2025, 4:51:40 PM📍 Your donation EFB-2025-1759672284290-9687 arrived at Armant Touchpoint Touchpoint. Track: http://localhost:5173/journey/EFB-2025-1759672284290-9687View JourneyEFB-2025-1759672284290-9687queued10/5/2025, 4:51:35 PM🚚 Your donation EFB-2025-17596722"
    },
    "journeyViewer": {
      "loaded": true,
      "notFound": false,
      "hasTracking": true,
      "h1": "",
      "hasProgress": true,
      "canScroll": false
    },
    "adminFinal": {
      "activeJourneys": "0",
      "completedJourneys": "0",
      "errorLogCount": 22,
      "hasSlider": true
    }
  },
  "issues": [],
  "logs": [
    "🔍 COMPREHENSIVE E2E TEST - ALL SYSTEMS",
    " ==================================================",
    "🔐 TEST 1: Supabase Connection & Auth",
    "💬 [vite] connecting...",
    "💬 [vite] connected.",
    "💬 %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold",
    "💬 📂 Initializing fresh settings",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 0",
    "💬    - settings.activeJourneys.length: 0",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 0",
    "💬    - settings.activeJourneys.length: 0",
    "💬 🔍 Checking 0 active journeys for progression",
    "💬 💾 Saved to localStorage - active: 0, completed: 0",
    "💬 🔄 settingsRef updated - active: 0, completed: 0",
    "💬 🟢 GlobalSettingsProvider MOUNTED",
    "💬 Auth state changed: INITIAL_SESSION undefined",
    "💬 ✅ Supabase connected successfully",
    "📸 Screenshot saved: 01-initial-load",
    "✅ Supabase environment check: {\"hasSupabase\":true,\"isOnline\":true,\"hasLocalStorage\":true}",
    "🧹 TEST 2: Clearing previous test data",
    "💬 🧹 localStorage cleared",
    "💬 [vite] connecting...",
    "💬 [vite] connected.",
    "💬 %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold",
    "💬 📂 Initializing fresh settings",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 0",
    "💬    - settings.activeJourneys.length: 0",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 0",
    "💬    - settings.activeJourneys.length: 0",
    "💬 🔍 Checking 0 active journeys for progression",
    "💬 💾 Saved to localStorage - active: 0, completed: 0",
    "💬 🔄 settingsRef updated - active: 0, completed: 0",
    "💬 🟢 GlobalSettingsProvider MOUNTED",
    "💬 Auth state changed: INITIAL_SESSION undefined",
    "💬 ✅ Supabase connected successfully",
    "⚙️ TEST 3: Admin Dashboard & Global Settings",
    "✅ Admin: {\"hasSlider\":true,\"sliderValue\":\"5\",\"activeJourneys\":\"0\",\"completedJourneys\":\"0\",\"hasErrorLogSection\":true}",
    "📸 Screenshot saved: 02-admin-initial",
    "💰 TEST 4: Complete Donation Flow",
    "💬 [vite] connecting...",
    "💬 [vite] connected.",
    "💬 %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold",
    "💬 📂 Loading settings from localStorage",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 0",
    "💬    - settings.activeJourneys.length: 0",
    "💬 🔍 Checking 0 active journeys for progression",
    "💬 💾 Saved to localStorage - active: 0, completed: 0",
    "💬 🔄 settingsRef updated - active: 0, completed: 0",
    "💬 🟢 GlobalSettingsProvider MOUNTED",
    "💬 Auth state changed: INITIAL_SESSION undefined",
    "💬 ✅ Supabase connected successfully",
    "✅ Donor page: {\"loaded\":true,\"donorCount\":0,\"hasDonateButtons\":true}",
    "📸 Screenshot saved: 03-donor-page",
    "💳 Triggering donation...",
    "✅ Donation triggered: {\"clicked\":true,\"buttonCount\":4}",
    "💬 ✅ Supabase: Loaded 6 programs (cached)",
    "💬 ✅ Supabase: Loaded 5 governorates (cached)",
    "💬 ✅ Supabase: Found 2 families for program school in luxor",
    "💬 💰 Donation recorded: Ahmed Hassan donated $50 → EFB-2025-1759672284290-9687",
    "💬 📱 Sending SMS to +201234567890: Thank you Ahmed Hassan! Your donation of $50 has been received. Track your journey here: http://localhost:5173/journey/EFB-2025-1759672284290-9687",
    "💬 [SMS] Queued to +201234567890: \"Thank you Ahmed Hassan! Your donation of $50 has b...\"",
    "💬 ✅ SMS sent with ID: SMS-1759672284291-1",
    "💬 🔵 registerJourney called for: EFB-2025-1759672284290-9687",
    "💬 🔵 BEFORE registration - settingsRef.current.activeJourneys.length: 0",
    "💬 🔵 INSIDE setSettings - prev.activeJourneys.length: 0",
    "💬 🔵 After registration, activeJourneys count: 1",
    "💬 🔵 Returning new state with 1 journeys",
    "💬 🔵 AFTER setSettings called - settingsRef.current.activeJourneys.length: 0",
    "💬 ℹ️ [INFO] Journey registered: EFB-2025-1759672284290-9687 {type: general}",
    "💬 ℹ️ [INFO] Donation received: Ahmed Hassan donated $50 {amount: 50, donor: Ahmed Hassan}",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 [SMS] Sent to +201234567890",
    "💬 [SMS] Delivered to +201234567890",
    "📸 Screenshot saved: 04-donation-triggered",
    "📦 Tracking ID: EFB-2025-1759672284290-9687",
    "🗺️ TEST 5: Journey Registration & Map Display",
    "💬 [vite] connecting...",
    "💬 [vite] connected.",
    "💬 %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold",
    "💬 📂 Loading settings from localStorage",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔍 Checking 1 active journeys for progression",
    "💬 ▶️ Starting progression for new journey: EFB-2025-1759672284290-9687 (Stage 1)",
    "💬 📊 Currently managing 1 journey progression intervals",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 📊 DonationTracker: 1 active, 0 completed global journeys",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 🟢 GlobalSettingsProvider MOUNTED",
    "💬 Auth state changed: INITIAL_SESSION undefined",
    "💬 ✅ Supabase connected successfully",
    "💬 ✅ Supabase: Loaded 5 governorates (cached)",
    "💬 ✅ Supabase: Loaded 6 programs (cached)",
    "🗺️ Map state: {\"hasMap\":true,\"hudText\":\"1 Active0 CompletedTotal: 1\",\"activeCount\":1,\"completedCount\":0,\"markerCount\":5}",
    "📸 Screenshot saved: 05-map-with-journey",
    "⏱️ TEST 6: Journey Auto-Progression (15s wait)",
    "⏳ Waiting for progression...",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 ℹ️ [INFO] Journey progressed to Stage 2/5 ",
    "💬 🚀 Journey EFB-2025-1759672284290-9687 → Stage 2/5",
    "💬 [SMS] Queued to +201234567890: \"📦 Your donation EFB-2025-1759672284290-9687 is be...\"",
    "💬 📱 SMS sent for Stage 2: SMS-1759672290908-2",
    "💬 ℹ️ [INFO] SMS sent for Stage 2 {smsId: SMS-1759672290908-2}",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 📊 Currently managing 1 journey progression intervals",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 [SMS] Sent to +201234567890",
    "💬 [SMS] Delivered to +201234567890",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 ℹ️ [INFO] Journey progressed to Stage 3/5 ",
    "💬 🚀 Journey EFB-2025-1759672284290-9687 → Stage 3/5",
    "💬 [SMS] Queued to +201234567890: \"🚚 Your donation EFB-2025-1759672284290-9687 has r...\"",
    "💬 📱 SMS sent for Stage 3: SMS-1759672295911-3",
    "💬 ℹ️ [INFO] SMS sent for Stage 3 {smsId: SMS-1759672295911-3}",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 📊 Currently managing 1 journey progression intervals",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 [SMS] Sent to +201234567890",
    "💬 [SMS] Delivered to +201234567890",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 ℹ️ [INFO] Journey progressed to Stage 4/5 ",
    "💬 🚀 Journey EFB-2025-1759672284290-9687 → Stage 4/5",
    "💬 [SMS] Queued to +201234567890: \"📍 Your donation EFB-2025-1759672284290-9687 arriv...\"",
    "💬 📱 SMS sent for Stage 4: SMS-1759672300915-4",
    "💬 ℹ️ [INFO] SMS sent for Stage 4 {smsId: SMS-1759672300915-4}",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 📊 Currently managing 1 journey progression intervals",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 [SMS] Sent to +201234567890",
    "💬 [SMS] Delivered to +201234567890",
    "⏱️ After 15s: {\"activeCount\":1,\"completedCount\":0,\"hudText\":\"1 Active0 CompletedTotal: 1\"}",
    "📸 Screenshot saved: 06-map-after-progression",
    "📱 TEST 7: SMS Notification System",
    "💬 [vite] connecting...",
    "💬 [vite] connected.",
    "💬 %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold",
    "💬 📂 Loading settings from localStorage",
    "💬 📱 Retrieved 4 SMS messages from service",
    "💬 📊 Processed 4 SMS messages for display",
    "💬 👤 Selected donor: 1, messages: 4",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔍 Checking 1 active journeys for progression",
    "💬 ▶️ Starting progression for new journey: EFB-2025-1759672284290-9687 (Stage 4)",
    "💬 📊 Currently managing 1 journey progression intervals",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 🟢 GlobalSettingsProvider MOUNTED",
    "💬 Auth state changed: INITIAL_SESSION undefined",
    "💬 ✅ Supabase connected successfully",
    "📱 SMS: {\"messageCount\":20,\"hasMessages\":true}",
    "📸 Screenshot saved: 07-sms-inbox",
    "👁️ TEST 8: Journey Viewer",
    "💬 [vite] connecting...",
    "💬 [vite] connected.",
    "💬 %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold",
    "💬 📂 Loading settings from localStorage",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔍 Checking 1 active journeys for progression",
    "💬 ▶️ Starting progression for new journey: EFB-2025-1759672284290-9687 (Stage 4)",
    "💬 📊 Currently managing 1 journey progression intervals",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 🟢 GlobalSettingsProvider MOUNTED",
    "💬 Error: An API access token is required to use Mapbox GL. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes\n    at T._makeAPIURL (http://localhost:5173/node_modules/.vite/deps/mapbox-gl.js?v=293d8616:17599:30)\n    at T.normalizeStyleURL (http://localhost:5173/node_modules/.vite/deps/mapbox-gl.js?v=293d8616:17540:90)\n    at To.loadURL (http://localhost:5173/node_modules/.vite/deps/mapbox-gl.js?v=293d8616:23059:82)\n    at To.load (http://localhost:5173/node_modules/.vite/deps/mapbox-gl.js?v=293d8616:23024:55)\n    at Map._updateStyle (http://localhost:5173/node_modules/.vite/deps/mapbox-gl.js?v=293d8616:31057:114)\n    at Map.setStyle (http://localhost:5173/node_modules/.vite/deps/mapbox-gl.js?v=293d8616:31047:174)\n    at new Map (http://localhost:5173/node_modules/.vite/deps/mapbox-gl.js?v=293d8616:30779:808)\n    at _Mapbox._initialize (http://localhost:5173/node_modules/.vite/deps/react-map-gl_mapbox.js?v=293d8616:394:17)\n    at new _Mapbox (http://localhost:5173/node_modules/.vite/deps/react-map-gl_mapbox.js?v=293d8616:315:10)\n    at http://localhost:5173/node_modules/.vite/deps/react-map-gl_mapbox.js?v=293d8616:840:18",
    "💬 Auth state changed: INITIAL_SESSION undefined",
    "💬 ✅ Supabase connected successfully",
    "✅ Journey Viewer: {\"loaded\":true,\"notFound\":false,\"hasTracking\":true,\"h1\":\"\",\"hasProgress\":true,\"canScroll\":false}",
    "📸 Screenshot saved: 08-journey-viewer",
    "💾 TEST 9: localStorage Persistence",
    "✅ Persistence: {\"hasPersistence\":true,\"activeJourneysCount\":1,\"completedJourneysCount\":0,\"errorLogsCount\":8}",
    "📊 TEST 10: Admin Dashboard Final State",
    "💬 [vite] connecting...",
    "💬 [vite] connected.",
    "💬 %cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools font-weight:bold",
    "💬 📂 Loading settings from localStorage",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔵 getAllActiveJourneys called:",
    "💬    - settingsRef.current.activeJourneys.length: 1",
    "💬    - settings.activeJourneys.length: 1",
    "💬 🔍 Checking 1 active journeys for progression",
    "💬 ▶️ Starting progression for new journey: EFB-2025-1759672284290-9687 (Stage 4)",
    "💬 📊 Currently managing 1 journey progression intervals",
    "💬 💾 Saved to localStorage - active: 1, completed: 0",
    "💬 🔄 settingsRef updated - active: 1, completed: 0",
    "💬 🟢 GlobalSettingsProvider MOUNTED",
    "💬 Auth state changed: INITIAL_SESSION undefined",
    "💬 ✅ Supabase connected successfully",
    "📊 Admin Final: {\"activeJourneys\":\"0\",\"completedJourneys\":\"0\",\"errorLogCount\":22,\"hasSlider\":true}",
    "📸 Screenshot saved: 09-admin-final",
    " ==================================================",
    "📊 TEST SUMMARY",
    " ==================================================",
    " ✅ Tests Completed: 7",
    " ✅  Issues Found: 0",
    " 📝 Console Logs Captured: 252",
    " ",
    " 🔧 CRITICAL FUNCTIONS:",
    "   📝 donationTrigger: {\"clicked\":true,\"buttonCount\":4}",
    "   📝 trackingIdGeneration: {\"trackingId\":\"EFB-2025-1759672284290-9687\",\"found\":true}",
    "   📝 autoProgression: {\"progressionLogCount\":6,\"progressed\":true}",
    "   ✅ smsNotifications: {\"smsLogCount\":8,\"smsInInbox\":20,\"working\":true}",
    "   📝 persistence: {\"hasPersistence\":true,\"activeJourneysCount\":1,\"completedJourneysCount\":0,\"errorLogsCount\":8}",
    " ",
    " 💾 SUPABASE TESTS:",
    "   📝 connection: {\"hasSupabase\":true,\"isOnline\":true,\"hasLocalStorage\":true}",
    " =================================================="
  ],
  "supabaseTests": {
    "connection": {
      "hasSupabase": true,
      "isOnline": true,
      "hasLocalStorage": true
    }
  },
  "criticalFunctions": {
    "donationTrigger": {
      "clicked": true,
      "buttonCount": 4
    },
    "trackingIdGeneration": {
      "trackingId": "EFB-2025-1759672284290-9687",
      "found": true
    },
    "autoProgression": {
      "progressionLogCount": 6,
      "progressed": true
    },
    "smsNotifications": {
      "smsLogCount": 8,
      "smsInInbox": 20,
      "working": true
    },
    "persistence": {
      "hasPersistence": true,
      "activeJourneysCount": 1,
      "completedJourneysCount": 0,
      "errorLogsCount": 8
    }
  }
}